{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/css-z-index-management-variables/",
    "result": {"data":{"cur":{"id":"c903c970-6699-5f9f-b24a-0623404c8686","html":"<p>프론트엔드 개발을 하다 보면 z-index 때문에 겪는 문제를 피하기 어렵습니다. 특히 프로젝트 규모가 커질수록 z-index는 예상치 못한 충돌을 일으키며, 가독성을 떨어뜨리곤 합니다. 예를 들어, 특정 UI 요소가 다른 요소에 의해 가려지거나, 의도한 대로 화면에 표시되지 않는 문제를 종종 경험하게 됩니다. 이 글에서는 CSS 변수를 활용하여 이러한 z-index 문제를 체계적으로 관리하는 방법을 공유해 보고자 합니다.</p>\n<h2 id=\"floating-ui\" style=\"position:relative;\"><a href=\"#floating-ui\" aria-label=\"floating ui permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Floating UI</h2>\n<p>대부분의 프로젝트에는 여러 개의 floating UI가 존재합니다. 예를 들어, Header, <a href=\"https://ui.shadcn.com/docs/components/drawer\">Drawer</a>, <a href=\"https://ui.shadcn.com/docs/components/dialog\">Dialog(Modal)</a>, <a href=\"https://ui.shadcn.com/docs/components/tooltip\">Tooltip</a>, <a href=\"https://ui.shadcn.com/docs/components/dropdown-menu\">Dropdown Menu</a> 등을 생각해볼 수 있습니다. 이러한 UI들은 동시에 여러 개가 겹칠 수 있으며, 이들의 레이어 순서를 명확히 정의하지 않으면 화면에서 엉뚱한 위치에 겹쳐 보이거나 클릭이 되지 않는 문제가 발생할 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 178.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAYAAACJ8xqgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE1klEQVRIx51W244TRxD1HyAR5QeIkg8kT4S8RRApEisIsIvYRCJPeYIIaSOBMHkBBeUBWMOuvevxfX332B7P/dIzJzpl96zXCbtKWir1dE/VqerTVTVTSJ4/R1ytQpXLiA8PoSoVJOWySHyBpEdH8EslsVW1GrJiEQXr7VsMkwQpgJHjojmeYGi78AGEAIJzRAF49fYdrChCy7aRGQYK2evXyLpdpPU6YsNAeHyMqGogqdUulLTRgKrXkXFud5C9eoVCNp8jm0yQmSYwnS7FNGWtBZ+QbHOez1HgUfXI8OmRnSPro+A4DkqlEoyqgdJ+Cfv7+6jX6zg4OMD++/c4+PgR7VYLlmUtgdMUyLKlaGerNeeC53kYjUbwfR+z2QxBEIhSkiRIEiUzFTnrkaZpruN5fg4qgIeHZdy8+T1u3LiJ69e/xd7eHra3d3Dr1haePn2KYrGIu3fv4f79+6Jz586PuH37DnZ2drC1tYW9vd8FUCm1BFwsFqhUKuj1ephMJjDNKTqdDtrttqwZdavVkuejoyPZ7/f7GA6HGAwGp1ToCI+Pj3Ht2jfY3f0JDx/u4tGjR2L0X0e24rRg27ZcgGEYODg4RKVyhF6vL5ySXwovjty6rpvv8ZlCe827RMiNRqOBdrsD0zRxctLFeDwW4FqtJo4ajSZGozGqVQPNZkuyoNVqC03U59FzwDAMZWM6nco8mRD0RLjrdrsYDkfCIXmjo37/VJc6zWZT+M2PPJ9b4nUwGAoADRkBn2nElOIJqMOL4HvuUTQgHeQRkgd6pZfFwhYl8letVlGvNwRMg3ImBYZRE57phHTQJgckd9vbD/DgwUPs7v4sOffmzRtRIB06sbUwqTefdaIL4OPHT3D58ue4cuVLfPHFV7h06TNcvfq1KH348DFPoWyj1NbXZ9JmOp3hxYsiisWXePnyDzx79lw43FS+SPLmcF6i/h8p8GjLRpAgjpeiVPpJgzS9AHCTn01Oznv/bzoCyIbAFGFdszoYdRRF6HS6EjnXrJTBYCQzeedgyXW7PTiOe3rLur8RgGnCmWtNhR5nKVE5QBzHeevKOeTGuuj8WjZQT5ys80QQ7nPWwOSddgWSzJD7g+GyYsypdGoq+X6AwXAEa2EjimMRDttxMJ6YYue4HsIwWoEqFHRU7Do8chCGsBYLMWTzJWeO64oOHdCQEetjzy1LuFwDTCV04WjFky4l1jQNPD+Q9wSmIQE83/9HGQogHxiZ4zrIUnXmA8l9l83U885cBCN0XQ9qBajUksMcMAhjWE4EL0hF3CBFojKJkFyRV3LleL4Ykpa5tRBOgzBa/ZRkwn2Bi3IrwQ+/+rj3m4d7Txx894uNd1UqpgIUBKFQQcA4URspleHPwxDtYSz6+ZHZaBe2I+EnaskhL4odm7ep00iTvw74VznCySg5BSTpE3Mu6REywaNIVNk42clnc0suTt8y02Y0nsgRlxEv/8VWHCr4oYLtRrBsX4zN6QyJUvINISAdMSJymmYp/DCCObNgO65QEUaxnCq/FD+I4PqReOTNESxdpQfp0KWl6zpiqrFDKSWniVapdnrLQSDfXvKx3kWYHuSRQATW+4yUX0ceXa34RpaeVgoNdFNYr1m1ahpSdmvVQaBub4DpbI4wDGBasaQa8/hvZbevnkbWrNMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Header UI\"\n        title=\"Header UI\"\n        src=\"/static/d8aebc0e58c681f0025b39deb28420ad/37523/1_header.png\"\n        srcset=\"/static/d8aebc0e58c681f0025b39deb28420ad/e9ff0/1_header.png 180w,\n/static/d8aebc0e58c681f0025b39deb28420ad/f21e7/1_header.png 360w,\n/static/d8aebc0e58c681f0025b39deb28420ad/37523/1_header.png 720w,\n/static/d8aebc0e58c681f0025b39deb28420ad/0f2bc/1_header.png 742w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>Header UI</em></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 177.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAYAAACJ8xqgAAAACXBIWXMAAAsTAAALEwEAmpwYAAADZUlEQVRIx61UWU8aURTmxfhkE5WkiVpZDCYqu6DxpRof+sPaH+CvcHvoS9Ok20Pfa1wTbARUVGAEZBCGRRlnvuYc59IZWSK2k3w5C+d+9zvnXq5tcHAQdrsdIyMjjNHRUYaIe0HUCgwMDMA2NjaGSCSC+fl5RjgcZpBP+V4IBoMMql9cXORNmJASoVCIf/T7/QzyKdcNtEbUEkhAi3BhYcGizKy0F8y10WgUw8PDVkJR0A2ixmwFLITUwtzcHLxeL1tqgXwBMYJeatsIA4EALyIrisS8hEJaZD6Uji2Pj49jamoKDocDRO52uxkUU97j8cDpdDImJiY4TxC+OCCLQmppZmaG2/P5fNw2gXwRkxU1ApRra5kUTk9Pg6zL5WIltJAOSrQmWiVr9kXbbQppbrOzsy1ltLuYp5itiDvlrQrpYodC8Hm9CPj9Lfh9PnipVcr7fByT7zd8gsjT+sVoFCNE+PrNG/gjEczR1TEwGwya/Md4xpQjeMPhx3wgwOvDS0t4ZbfD5h0awqrLjbeTk1hxOhnkLzscWHE42C5TbPwu8sInrLrdeOfxwEWPw+e1NXz/+BFf1tfxbWvLgq+bmy3L/uYWvm5s4vuTuh/b2/j56RM23n+ADYqC//aVbmFT02kojQaUchl3jQYeHh7woKp/QXE3qIZtNqEBuL+8hE2XJKQyGfw+PoYsy22b6rresgLmmH1NY0vibJokodZssrparYZKpYJqtQpFUXh3M2m37y9h5lHheTqN02QSZ2dniMcTSCaTODk5QbVa659Qy2ZRvb+HUqmwQgIpfNpyX4TZQgHJRAKJRBLxeJzVEfHTWT275WKlgpIst0g6HUhfhKlMlmeYzWahaVrbafbXsiThtlaDXCzyyT4letEMr4tFXKRSKBQKz55bz5ZvymXkcznkcnnc3d09W1lHQlxfc8vpqytcXFxYTvdFhNQynfK1JEFRql3/Zn21nC+VkDo/t8zwxRebCDvdvX8iPIjFsPNrB4eHR9jb20csFsPu7i4kY7O+W66rKhr1Oh9IvV430ICqqi97HEpKFTnp8drk8wXIRdlaTIQ9oBvPHL+Hej4P0qFqGpoMnWPdAEy2q0LDqpIEm358jEIiiezhETIHR0jvH6J8egbc3IA2wzOg53KALEONxfAHhypG4giRK3IAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Drawer UI\"\n        title=\"Drawer UI\"\n        src=\"/static/4952e62eb80bdb4808bac12203619a5a/37523/2_drawer.png\"\n        srcset=\"/static/4952e62eb80bdb4808bac12203619a5a/e9ff0/2_drawer.png 180w,\n/static/4952e62eb80bdb4808bac12203619a5a/f21e7/2_drawer.png 360w,\n/static/4952e62eb80bdb4808bac12203619a5a/37523/2_drawer.png 720w,\n/static/4952e62eb80bdb4808bac12203619a5a/1d69c/2_drawer.png 750w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>Drawer UI</em></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 179.44444444444446%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAYAAACJ8xqgAAAACXBIWXMAAAsTAAALEwEAmpwYAAADa0lEQVRIx61WW08TQRSeBEPiT4Dw0ssWa0tvlEcRTZTwAhITogH9J77p7zCA3H8DWoNUa0BKKRA0vID2wkWBSLvd7u5nzqGzrNByn+TrOeebOd+emc7ujIhEIrgOwuGw5be2tkKEQiEEAgEmAoEgWlpaOKaB54FyPJ5mkIbf7+dYXLfCkxBU5lmQU6nVZ58uC1LpcorBYBA+n4+nLe3JhGoi9odYFUajUcbJ5Fp8zSlTVQ6HA263m9Hc3Myxy+XiWFEU5i4ixhWSoMfjYQGyNFUZkyBZp9PJVV5kvUUrKRPCEURoK4TCbCVHluJwKFQToWCQx0VJsCUahS8cZtwNHVvpH/MRK/ZHIgzpkw22tSHQ1gbRqSi453DivrMCl4ttu8NxzFVii7ONaXc40eFy4aHHgy5FgchNTWFjaQmbc3PYnJ/Hr2QSvxYW8LMCGbOVfd8W2GaSSc6hXNLIT05CYH0d9lbUdegATAAGANUwUWZroGSa0Cp9xBXK5f9ySUsYqRQnGprG3GIyifhsHIkvCXxNJDD76RPeT09jZmYGsQ8xjufn5plbW1vjHMpljVQKAum09YBCoQhd16GqJZRKGsrlMjRNY594ilVVZY58QrGoAqbJ+WY6DUE/Kk2pUMSfP3vIZnPIZvPY2trG9vaOZaWfz29hZ2eXkcvlsbv7G6WierQUUnD37yHyLHKUuLe3j42NTWQyWX6AFMpkcmwpJkES4wflt7BHlUrBao1moevGKV7TyqjVuEKsrOBD/DMG3w5ibGwcIyNjGB0dw/j4BCYmJtkfHn7HGBkZZY765DjKoVzSIC2B5WV0PO6CEAL19bdRV1dvQYhbaGhogtfrh6LcQWNjE3P2MZRDuaRBWlzhq9dv0PmoE729T9HT02uhu/sJ+vqeYWDgJfr7X6Cv7zlz9jGUQ7mkcVRhjTWUzTAMFAoFHB4esn9mozXUF1O862lz0l4zKtDpLTBNHBwcIL2UZhzs7zNHfdY4srQvAZDWqVfvWo1eve9DQ1iJx7Eai2H148erIRZjjR+DQxAPFIU/Pw/cbnRcEZxLnzD6fNGH8SZxfATcEES1c/eiJ1w1X1Q7tO3ceTeKcwXtPt0m6CJkh7wkXbhCu09XFDrkvV4vg3x5U7uS4Fn3wUuvYa21utYa3ti/fBmcFPwHuNFzwmC+gTMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Dialog UI\"\n        title=\"Dialog UI\"\n        src=\"/static/70427c04af662fd439cb73f12e4fcf81/37523/3_dialog.png\"\n        srcset=\"/static/70427c04af662fd439cb73f12e4fcf81/e9ff0/3_dialog.png 180w,\n/static/70427c04af662fd439cb73f12e4fcf81/f21e7/3_dialog.png 360w,\n/static/70427c04af662fd439cb73f12e4fcf81/37523/3_dialog.png 720w,\n/static/70427c04af662fd439cb73f12e4fcf81/0f2bc/3_dialog.png 742w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>Dialog UI</em></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 127.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAACI0lEQVRIx91U23abMBDk//8tGALGpIAJGDvBNjebq4SYnhWloalvyUMfuufM2UVaDaNdSYpYLiF0Hdw0wQ3jIfSmKSHMJeR6gmVBLDQo7OkJQ1kCfQ9wPoLiCdP3bG5oW4imwUBoWwx1jWEY0C+XUHrLAmcMP1wPlm3DcV3pdcOAtbLhrtfy2/N9rF5eJHohMNkw89zzoBAraxoEYYhos5EIwxDbaAvP9eD7Pna73Ti23SIIAhyPR6RpijzLgGHAIMRI6DijQgiBNC+wPxxwOB4R7/dIsgxv77GM0ywb55JExjS2iSLE+wPmJhVyVQUrCgiqC9Wj6wDGPuKuG+tEfhZTDnlWVWDnEoxzMJNqaNtoVBWtYaAzDNSahlJVUes6Gl1HtVigVC9Blb5aaDKn0jTw52coJDVJEriuC8dxcDqdpPw0zfD29g7GOL5iCmMMcRzD89ZYrWzZAM456rpBlheSkApOx+IRKG3bSoV5Xkh1FNd1/XEsxAAhxE30/egl4S3580W3VOHXDihPmRaQQkJDZzIIEEUROuoidXx2kC8Z5ZZlNdZwImyaVm6VapZlGfI8l7UkTIR/Kxv9+XyWP5ZbnrbziF3Km4/93vKjHfxMNK/fHzX8PHGP7JLCq4Rftf+A8JF6Xsu/qnCu9FpzLq25q/DSDbmXf5OwKE5wHA9huMHrayBfJLqeQnyTkBbTk0ZEnufDslbynfw24bWr9k+b8hOnRemJ3x855QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Toast UI\"\n        title=\"Toast UI\"\n        src=\"/static/8fed338c0b8db518d9fd433dc9835c77/37523/4_toast.png\"\n        srcset=\"/static/8fed338c0b8db518d9fd433dc9835c77/e9ff0/4_toast.png 180w,\n/static/8fed338c0b8db518d9fd433dc9835c77/f21e7/4_toast.png 360w,\n/static/8fed338c0b8db518d9fd433dc9835c77/37523/4_toast.png 720w,\n/static/8fed338c0b8db518d9fd433dc9835c77/0f2bc/4_toast.png 742w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>Toast UI</em></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 648px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAABK0lEQVQ4y9WU0WrCQBBF/f+faWmf2hcfWgTb1KpRrEWMohYrgkUlMbO7c4qxEZWksdAXA5dJNpezM7uzW+Kfn9IFAVV3OnwvUurNA2oSdgYtUOrPB57AEEEztB3H2mNobskptNlEa7Uk0tiqsZf6PlqpwGJRkGE6WxSh9TrWOcQY4jhGxBCLICIYwPV6MBodLVE+cLNJsjAivHe7tFstBkHAW6dDp91mOp+jQYBOJmcCtxn6PrEqyzBiFW0IjSEU4Wu1ZqWK6fdhPC4GJsE5qFZRz0M8j+ndPf2ra4Y3tywfHrGvdbRcRmezP+yytUnpsl7zEQxoPHk0n19YfM5wYbjrgLSqc/owtVhV3IHfOLf/pxkt8+tJOZxZM76LT0pW6T+gU5GxGZdz23wDs1g5aFwRaTQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Tooltip UI\"\n        title=\"Tooltip UI\"\n        src=\"/static/fd8b70338041f078414123b4c86d168f/3996e/5_tooltip.png\"\n        srcset=\"/static/fd8b70338041f078414123b4c86d168f/e9ff0/5_tooltip.png 180w,\n/static/fd8b70338041f078414123b4c86d168f/f21e7/5_tooltip.png 360w,\n/static/fd8b70338041f078414123b4c86d168f/3996e/5_tooltip.png 648w\"\n        sizes=\"(max-width: 648px) 100vw, 648px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>Tooltip UI</em></p>\n<h2 id=\"레이어-정의\" style=\"position:relative;\"><a href=\"#%EB%A0%88%EC%9D%B4%EC%96%B4-%EC%A0%95%EC%9D%98\" aria-label=\"레이어 정의 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>레이어 정의</h2>\n<p>z-index 값을 무작위로 부여하는 대신 레이어의 목적에 따라 층위를 나누어 설계하면 더욱 체계적인 관리가 가능합니다. 예를 들어, 다음과 같이 레이어를 나눌 수 있습니다.</p>\n<ol>\n<li><strong>기본 레이어</strong>: 페이지의 주요 콘텐츠 (– <code>-z-index-base</code>)</li>\n<li><strong>UI 레이어</strong>: 드롭다운, 메뉴 (– <code>-z-index-dropdown</code>)</li>\n<li><strong>알림 레이어</strong>: 툴팁, 팝업 (– <code>-z-index-tooltip</code>)</li>\n<li><strong>상호작용 레이어</strong>: 모달, 다이얼로그 (– <code>-z-index-modal</code>)</li>\n<li><strong>오버레이 레이어</strong>: 전체 화면을 덮는 요소 (– <code>-z-index-overlay</code>)</li>\n</ol>\n<p>아래와 같이 미리 레이어의 종류를 정의하고 CSS 변수로 관리하면 새로운 요소를 추가할 때도 쉽게 일관된 구조를 유지할 수 있습니다.</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">:root {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  --z-index-base: 0;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  --z-index-dropdown: 10;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  --z-index-tooltip: 20;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  --z-index-modal: 30;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  --z-index-overlay: 40;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span></code></pre>\n<h2 id=\"z-index-변수-사용\" style=\"position:relative;\"><a href=\"#z-index-%EB%B3%80%EC%88%98-%EC%82%AC%EC%9A%A9\" aria-label=\"z index 변수 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>z-index 변수 사용</h2>\n<p>CSS 변수(<code>var()</code>)를 사용하면 z-index 값을 중앙에서 관리할 수 있어 레이아웃의 레이어를 쉽게 예측하고 수정할 수 있습니다. 이 방법을 활용할 경우 아래와 같은 장점이 있습니다.</p>\n<ol>\n<li><strong>가독성 향상</strong>: <code>var(--z-index-tooltip)</code>과 같이 명확한 이름의 변수를 사용하면, 각 요소의 z-index가 무슨 목적으로 정의되었는지 쉽게 알 수 있습니다. 단순히 숫자만 있는 코드보다 가독성이 높아집니다.</li>\n<li><strong>일관성 유지</strong>: 프로젝트가 커질수록 각 컴포넌트마다 임의의 z-index를 설정하다 보면 예기치 않은 레이어 충돌이 발생할 수 있습니다. CSS 변수로 일관되게 z-index 값을 관리하면 이러한 문제를 예방할 수 있습니다.</li>\n<li><strong>유지보수 용이성</strong>: 만약 모달과 관련된 모든 z-index를 조정해야 하는 경우, 변수 하나만 변경하면 전체가 반영됩니다. 수십 개의 CSS 파일을 수정할 필요가 없으며, 실수를 줄일 수 있습니다.</li>\n</ol>\n<p>위에서 정의한 변수들을 사용해 스타일을 적용하면 다음과 같이 작성할 수 있습니다.</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">.header {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  z-index: var(--z-index-base);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">.dropdown-menu {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  z-index: var(--z-index-dropdown);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">.tooltip {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  z-index: var(--z-index-tooltip);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">.modal {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  z-index: var(--z-index-modal);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">.modal-close-button {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  z-index: calc(var(--z-index-modal) + 1);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">.overlay {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  z-index: var(--z-index-overlay);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span></code></pre>\n<p>모달 안의 닫기 버튼과 같은 특정 요소에 대해서는 <code>calc()</code>를 사용하여 모달보다 높은 z-index 값을 부여할 수 있습니다. 예를 들어, <code>.modal-close-button</code>에 <code>z-index: calc(var(--z-index-modal) + 1)</code>을 적용하면 모달 내부의 다른 요소들 위에 자연스럽게 배치할 수 있습니다.</p>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p>CSS 변수를 사용하여 겹치는 UI들의 z-index를 효과적으로 관리할 수 있는 방법을 고민해보았습니다. 프로젝트 내에서 사용되는 floating UI들을 기준으로 정리를 시작해보면, 복잡했던 레이어 관리가 훨씬 단순해질 것입니다. 이 전략이 여러분의 프로젝트에 도움이 되었길 바라면서 이번 글을 마치겠습니다.</p>\n<h2 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h2>\n<ul>\n<li><a href=\"https://web.dev/learn/css/z-index?hl=ko\">Z-색인 및 스택 컨텍스트</a></li>\n<li><a href=\"https://ishadeed.com/article/understanding-z-index/\">Understanding Z-Index in CSS</a></li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","excerpt":"프론트엔드 개발을 하다 보면 z-index 때문에 겪는 문제를 피하기 어렵습니다. 특히 프로젝트 규모가 커질수록 z-index는 예상치 못한 충돌을 일으키며, 가독성을 떨어뜨리곤 합니다. 예를 들어, 특정 UI 요소가 다른 요소에 의해 가려지거나, 의도한 대로 화면에 표시되지 않는 문제를 종종 경험하게 됩니다. 이 글에서는 CSS 변수를 활용하여 이러한 z-index 문제를 체계적으로 관리하는 방법을 공유해 보고자 합니다. Floating UI 대부분의 프로젝트에는 여러 개의 floating UI가 존재합니다. 예를 들어, Header, Drawer, Dialog(Modal), Tooltip, Dropdown Menu 등을 생각해볼 수 있습니다. 이러한 UI들은 동시에 여러 개가 겹칠 수 있으며, 이들의 레이어 순서를 명확히 정의하지 않으면 화면에서 엉뚱한 위치에 겹쳐 보이거나 클릭이 되지 않는 문제가 발생할 수 있습니다. \nHeader UI \nDrawer UI \nDialog UI…","frontmatter":{"date":"November 24, 2024","title":"CSS 변수로 Z-Index 관리하기","categories":"framework","author":"soobing"},"fields":{"slug":"/css-z-index-management-variables/"}},"next":{"id":"c7c3d0a3-b722-541d-af79-dfa5fd9d9425","html":"<h2 id=\"tldr\" style=\"position:relative;\"><a href=\"#tldr\" aria-label=\"tldr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TL;DR;</h2>\n<p>Next.js에서 React 18 라이브러리를 사용하면서 <code>'use client'</code> 디렉티브 문제를 해결하기 위해 <a href=\"https://www.npmjs.com/package/rollup-plugin-preserve-use-client\"><strong>rollup-plugin-preserve-use-client</strong></a> 플러그인을 개발한 과정을 공유합니다.  <a href=\"https://github.com/Ephem/rollup-plugin-preserve-directives\">rollup-plugin-preserve-directives</a> 을 사용할 수 없었던 이유와, <code>preserveModules</code> 옵션을 <code>false</code>로 사용하면서 <em>클라이언트 컴포넌트</em>에만 <code>'use client'</code> 디렉티브를 유지할 수 있는 방법을 찾는 과정을 설명합니다.</p>\n<h2 id=\"1-개발하게-된-배경\" style=\"position:relative;\"><a href=\"#1-%EA%B0%9C%EB%B0%9C%ED%95%98%EA%B2%8C-%EB%90%9C-%EB%B0%B0%EA%B2%BD\" aria-label=\"1 개발하게 된 배경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 개발하게 된 배경</h2>\n<p>저는 React 18을 활용한 UI 라이브러리를 개발하여 npm 모듈을 만들었습니다. 이 UI 라이브러리를 활용하여 Next.js 프로젝트에서 사용하려던 중 아래와 같은 문제를 마주치게 되었습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSUlEQVQoz21S246CUAw8n2CiEgVFUAwXEQgXN+Emifro/3/ObKab7rKbfWimFDpMpzVJHGMcR7Rti2EY8Hg80DQNsixDnue4XC6IoghpmiJJEsRxLO+YHw4H7HY77Pd7uK4Lx3Fg4igSoufzib7vhZgE+hFRm+ahNaLmtm3DVGWJru+/yaiuqirUdY2yLEUl1RVFIcqu16vUicfjUX7qeZ4ESY3tOOi6Dvf7XUjf7zfCMMRiscBqtcJyufyF83y9XsOyLMGvsGA+mkaIpmkShVRDJaqIz/SNSD/pnXoYBIEoo9LT6SRqzfl8FoUkJb5eL2nwfV8+ItJ8NrF5nm+3W2w2GwnNTZ5l4iGJSEj/ODKJ1BuSKGqu3tE3rXM5Zn42VMmzud1usgyOrSNzCTqynpMSkpyEDgnpA5XxbIj0kjUa/2P2/8GF/I1PUIwFwgf1bI0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"에러발생\"\n        title=\"에러발생\"\n        src=\"/static/5361149a6fd5a2d4037a692aa242033a/37523/1_error.png\"\n        srcset=\"/static/5361149a6fd5a2d4037a692aa242033a/e9ff0/1_error.png 180w,\n/static/5361149a6fd5a2d4037a692aa242033a/f21e7/1_error.png 360w,\n/static/5361149a6fd5a2d4037a692aa242033a/37523/1_error.png 720w,\n/static/5361149a6fd5a2d4037a692aa242033a/940c5/1_error.png 772w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>useState only works in Client Components… 에러 발생</em></p>\n<p>문제의 원인을 파악하다가, 처음에는 UI 라이브러리에 클라이언트 컴포넌트와 서버 컴포넌트를 분리하여 번들링하지 않아서 발생하는 문제라고 생각했습니다. 관련해서 아래와 같은 글을 참고했었습니다.</p>\n<ul>\n<li><a href=\"https://www.bekk.christmas/post/2023/19/keep-up-with-react-server-components-how-to-support-it-in-your-library\">How to support React Server Components in your library</a></li>\n</ul>\n<p>그러나 UI 라이브러리는 파일마다 청크를 생성하고 있었기 때문에 이는 잘못된 접근임을 알 수 있었습니다. 다시한번 에러 로그에 집중해서 문제의 원인을 찾기 위한 삽질을 하다보니, 아래와 같은 이슈를 확인할 수 있었습니다.</p>\n<ul>\n<li><a href=\"https://github.com/rollup/rollup/issues/4699\">‘use client’ directive for Client Components #4699</a></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACVUlEQVQ4y32SW48cNRCF5///HxQtQogovIB4IAglmiCyMz19m56++m53uz9k78yyeYAjHZVtWaeqTtVBKIMSmmmcWaRmnEWO0yKZhXo9p/d0T+fHm9QW6wPGeZR1OR7CuvLpdKSsStr2SlU3tNeOum5o2itN09J1N279iHWOhBh3YoyZCTY4vj9+YLGSg/GGd3/+RNHViFTBvCCERCqFkBJrLd4HUuJti+z7Ttx3dl6w7xD3iAk2x4MUgtOXZ5QydwGH84GYP75wiztbjFlw3SJh3XDO4ZRMkrzFIaVwwXOpa/4+V1wnjdSaRSYPEwWLEEzSMCub734NqBD5dNP0JrCGkCtPPGRPnKc5Hmm+nugvFWNZMl7e8kKfYllxOxeYumIYBe+Lha+DQmt1b/8uuBlD8/EPrscvuKYmdB3hemXtujtvxL5nH3riMBDbK+s8s6/+tdVvKkzeyGVhmabsy2YUXmusUhgpcVqnT/8yxuzzImR28EXs4eF9DZwzeQ30Bq2J6LCxxS1P9DHV/c0IvPdM05yH86jutcKknnZQLjPPs+XpLHnuF4xW+BBY1/WbthLSpFOF8yJQ2qCNzZ0eHp+SYFrkeRwx85jbn+YZbQzGWtbU6h3ql99wZY2PMe+pti4nyC1LsfDX589Mi2AYZ8YUZ4EyNmfVxmGsz575sOazGmeGYeTn9z/y9N07Pjz9wMfff8UE91Jh8qG4lBRFwbm4UBQXqqqmLKv8nmK6X8qK87ngNowY5zidztRVza1t6W8dIYT7UJKo1QRv2Lbtf7ne43/hH5mLNX7MorYcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"이슈\"\n        title=\"이슈\"\n        src=\"/static/42ca8f13087fc5264b04b12e26e9ed90/37523/2_issue.png\"\n        srcset=\"/static/42ca8f13087fc5264b04b12e26e9ed90/e9ff0/2_issue.png 180w,\n/static/42ca8f13087fc5264b04b12e26e9ed90/f21e7/2_issue.png 360w,\n/static/42ca8f13087fc5264b04b12e26e9ed90/37523/2_issue.png 720w,\n/static/42ca8f13087fc5264b04b12e26e9ed90/302a4/2_issue.png 1080w,\n/static/42ca8f13087fc5264b04b12e26e9ed90/07a9c/2_issue.png 1440w,\n/static/42ca8f13087fc5264b04b12e26e9ed90/081ff/2_issue.png 2182w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>‘use client’ directive for Client Components issue #4699</em></p>\n<p><a href=\"https://github.com/0xcadams\"><strong>@0xcadams</strong></a>가 제기한 이슈 내용을 살펴보면,</p>\n<ul>\n<li><a href=\"https://nextjs.org/blog/next-13\">Next.js 13</a>의 클라이언트 컴포넌트는 React의 <a href=\"https://github.com/reactjs/rfcs/blob/main/text/0227-server-module-conventions.md#basic-example\">RFC 227</a>을 기반으로 클라이언트 전용 컴포넌트임을 표시하기 위해 <code>use client</code> 디렉티브가 필요합니다. 그러나 현재, Rollup을 사용한 빌드에서 모듈 수준의 디렉티브가 지원되지 않아 빌드 오류가 발생하고 있음을 이슈 제기하고 있습니다.</li>\n</ul>\n<p>이에 대해 <a href=\"https://github.com/lukastaegert\"><strong>@lukastaegert</strong></a>는,</p>\n<ul>\n<li><strong>번들링 시 여러 모듈이 경계 없이 하나의 청크로 합쳐지기 때문</strong>에 모듈 수준 디렉티브를 금지하고 있다고 설명합니다. <strong>모듈 수준 디렉티브를 허용할 경우, 청크 내 모든 모듈에 해당 디렉티브가 적용</strong>되어 문제가 발생할 수 있다는 점도 지적했습니다. 만약 이러한 디렉티브가 출력에 꼭 필요하다면, <strong>배너 옵션</strong>이나 <strong>플러그인 훅</strong>을 통해 추가할 것을 권장합니다.</li>\n</ul>\n<p>이 쓰레드를 쭉 읽다보면 <a href=\"https://github.com/Ephem\"><strong>@Ephem</strong></a>는 <a href=\"https://github.com/Ephem/rollup-plugin-preserve-directives\">ollup-plugin-preserve-directives</a> 플러그인을 만들어서 소개했고, 저도 이 플러그인을 통해 문제를 해결될 것이라는 부푼 기대감으로 시도를 해보았습니다.</p>\n<p>그러나, 위 플러그인은 Rollup의  <code>preserveModules: true</code> 설정을 필수로 요구하고 있습니다. 해당 옵션을 <code>true</code>로 설정하는 경우 directive는 정상적으로 보존되지만, <a href=\"https://www.npmjs.com/package/vite-plugin-lib-inject-css\">vite-plugin-lib-inject-css</a> 플러그인과 충돌이 일어나 모든 module.css의 링크가 끊기고 스타일이 제대로 적용되지 않는 새로운 이슈를 발생시켰습니다.</p>\n<p><a href=\"https://www.npmjs.com/package/vite-plugin-lib-inject-css\">vite-plugin-lib-inject-css</a>의 공식문서를 살펴보면 <code>preserveModules</code>가 <code>true</code>인 경우, <strong>청크와 참조된 CSS 간의 연관성이 어떤 이유로 인해 손실되며, 이 경우에도 스타일 주입이 생략</strong>된다고 설명하고 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.33333333333331%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAADYElEQVRIx41V2Y7aQBDc//+sPERRVqsERcTGNrAGfB/j8QkGXFE1jJfNbanU7WPKfdT0PEVRhOXyOyzLhm07sFcOXNeD43pwvbX4vr9DEMaIohhhGIFriJsfI7q/I5622y1s24ZuGgyRjzJNUGmNoihQ1zXSNEWeFwiyHEkSQ9c1yrJEWZTwCh9hEqHUBZIsRppmeLper8iyDJZtw7FtfF8u0fc9zDVN0w2YwG8vl8uM8XLG+XwWn5Z44iJGwkiDMMThcJD74/EoxMQwDOi6DqfTCf+6hLCqKqzXa+x2OwF9/oDWsix4nidlYfq8GOkc+U8QwnEcobWWyEhufH7wv9c7QqailBIiErLotEzT/MTYx/eEaR6jnlPmTdM0Qti2rdSNjQqCQORBf7/fC9HfIpwJmXKe57KQBHEcv0MYhvKeYB3ZOP6AoM8of4nQLGL6TJWdNR021vjMhN+SyKwxUQoh9cPomBJTZk0I+vyYGVBG9A3+lPbclK5t0TS1EBNJksjfSWzqS99YrjFiNuKeU75czlB1h1K3EgkjIriI97+DET3xKPp7DS8oVA0/quDHGllZC5S6yaIslYAyUZSNUsiLUvY8Lb9jAO8Ic1XjNeuwy1qUdYv+OOA4jhjGEwaxI4bTaW7Oz3gjnIDLNKFXCvsPzzh8fEH86QvUywL581fUXxbQLy/Qn59RWxZ0c2uakh1VS5SMmGm/1fB6Ra1K6EOAKkpRBgl0mKAKYzRRgiaK0IQh2jRF23XSfTbqZm8/6IfhgfB8Rtf1GK9XnA2mK66YxOfz/08ZkK5Rg0aw9PP71ivyHKosRRbcAH/DTFhrDcdx8Pr6Knaz2cB1XSwWC7ieJ8/Pd51N/5g4N2GPoxS5UupW5KKAolwYLfdwmiJLkhlJGIqNggAJz5fDAcf7lL8Rti10lknqXd+jJpllQa1WKCwLhW2jtO35njZbLpF8+wbtukhp9/sHwqGHLop5uMr2altU3Grcdo+Wc5Gy4Xd3+TRtK0qZCSmBzXYro561o1173nwvdV2vxbqOI8dDyFkZhjKlOOLIMRNST77vyxlCsCnenZBniQHPl9VqNTeO73lP0nfClgg3m/lw4gIOTk6cx4FLn8+MTyJac1K+1fB0mpXPP7GGnCJ/mjS/gxH2D8BXDPtW0MikAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"vite-plugin-lib-inject-css\"\n        title=\"vite-plugin-lib-inject-css\"\n        src=\"/static/b8a3c70b09d8dffc8559f24da5f5d09a/37523/3_injectcss.png\"\n        srcset=\"/static/b8a3c70b09d8dffc8559f24da5f5d09a/e9ff0/3_injectcss.png 180w,\n/static/b8a3c70b09d8dffc8559f24da5f5d09a/f21e7/3_injectcss.png 360w,\n/static/b8a3c70b09d8dffc8559f24da5f5d09a/37523/3_injectcss.png 720w,\n/static/b8a3c70b09d8dffc8559f24da5f5d09a/302a4/3_injectcss.png 1080w,\n/static/b8a3c70b09d8dffc8559f24da5f5d09a/d4b10/3_injectcss.png 1394w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>vite-plugin-lib-inject-css 플러그인 옵션</em></p>\n<p>결국 모든 파일을 entry로 설정하여 preserveModules를 우회하는 방법을 설명하며, 해당 옵션은 필수적으로 <code>false</code>로 설정해야 정상적으로 css가 연결됨을 확인 할 수 있었습니다.</p>\n<p>이에 <code>preserveModules</code> 옵션을 <code>false</code>로 사용하면서 클라이언트 컴포넌트에 한해 <code>\"use client\"</code> 디렉티브를 주입하는 플러그인을 직접 개발하기로 결심했습니다.</p>\n<h2 id=\"2-rollup-플러그인-개발을-위한-지식\" style=\"position:relative;\"><a href=\"#2-rollup-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8-%EA%B0%9C%EB%B0%9C%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%A7%80%EC%8B%9D\" aria-label=\"2 rollup 플러그인 개발을 위한 지식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Rollup 플러그인 개발을 위한 지식</h2>\n<h3 id=\"플러그인-개념과-컨벤션\" style=\"position:relative;\"><a href=\"#%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8-%EA%B0%9C%EB%85%90%EA%B3%BC-%EC%BB%A8%EB%B2%A4%EC%85%98\" aria-label=\"플러그인 개념과 컨벤션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://rollupjs.org/plugin-development/#plugins-overview\"><strong>플러그인 개념과 컨벤션</strong></a></h3>\n<p>Rollup 플러그인은 properties, build hooks, output generation hooks 중 하나 이상을 포함하는 <strong>객체</strong>입니다. 그래서 작성한 코드를 살펴보면 Plugin 객체를 리턴하는 간단한 함수임을 확인할 수 있습니다.</p>\n<p>또한, 작성한 플러그인은 공식문서에서 제공하는 <a href=\"https://rollupjs.org/plugin-development/#conventions\">컨벤션</a>을 따라야 합니다. 간략하게 소개하면 아래와 같습니다.</p>\n<ul>\n<li>플러그인 이름은 <code>rollup-plugin-</code> 접두사를 사용하여 명확하게 지어야 합니다.</li>\n<li><code>package.json</code>에 <code>rollup-plugin</code> 키워드를 포함해야 합니다.</li>\n<li>플러그인은 테스트되어야 하며 mocha 또는 ava 사용을 권장합니다.</li>\n<li>문서는 영어로 작성해야 합니다.</li>\n</ul>\n<h3 id=\"build-hooks\" style=\"position:relative;\"><a href=\"#build-hooks\" aria-label=\"build hooks permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://rollupjs.org/plugin-development/#build-hooks\"><strong>Build Hooks</strong></a></h3>\n<p>Rollup은 번들링 과정에서 여러 단계에 걸쳐 다양한 빌드 훅을 제공합니다. 빌드 훅은 Rollup이 번들링을 시작하고 종료하는 과정의 특정 지점에서 호출되며, 플러그인을 통해 이 단계들을 커스터마이징할 수 있습니다. 주요 빌드 훅은 다음과 같습니다.</p>\n<ul>\n<li><code>buildStart</code>: 번들링이 시작될 때 호출되며, 초기화 작업을 수행할 수 있습니다.</li>\n<li><code>resolveId</code>: 모듈 ID를 해결할 때 호출되며, 사용자 정의 모듈 로딩을 구현할 수 있습니다.</li>\n<li><code>transform</code>: 각 모듈을 번들에 포함하기 전에 호출되어 코드를 수정할 수 있습니다.</li>\n<li><code>moduleParsed</code>: 모듈이 파싱된 후 호출되며, 모듈의 메타데이터를 사용할 수 있습니다.</li>\n<li><code>buildEnd</code>: 번들링이 완료된 후 호출되며, 정리 작업을 수행할 수 있습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 136.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAABYlAAAWJQFJUiTwAAADQ0lEQVRIx41VaW/bOBD1//8XXRRt2qIH9ltaIMAWaIugKJI0CFo3cR3JtmSdpg5SpETpLYY2uT7ibAmMRWrIpzdvhuNRWxaIfB9hFKOVEkkUoaoq0Bj6HsMwHJjxbZ77Y6R4hoV3h2zFoLVGIyVarfHYOAZmAIehX8+0hmYMPWMYlIImy3NjvVToOwVd5ei79nGG1sHnc9y/eoXps2dgkwlEGGJ6coLp8+eo/RnKyMPv0yfgWfhngH3fo1PKGM2H/TWAUggbM44FPfo/TezgQQDvyxfINP0zhg9l01i/1ji/vIT38gXK8dhVwEPAjwKa95ah6jCLcyjdP0pgtO18qDwsE5be4cfFGxS5d8Bs+/xo30G12LatM6UU2k6jXE2x9P7Brx9fkSQZmkZACIGu63bOO4b2MG0gUL1X3LSczSNEcYqmacA5N3vpSeYY0g85tr+0FbQrIalaeLfvEc6ujK68rv+rgA24AyR228mhNecCXAgwViBJUqxYgVV6j7l/CyEapEniQLZDPwCkcMj05oolSYQoCh0bKdfaMsZMEyFpHgSk0OI4xmw2R9c2CKanmP16A+/na/jjt/h98xJL7wxKSfi+j+vrayyXS6P7UYbErCwKDL1GwxOk8RSrzEeW3KMqAvAqRlEUyLIcaZq6aEhDAnaANqP9MEDpdehlWaMo1sKrVptEULgXF5fwPM8BELvFYmHYOkD6aiMVGpZi/v0TFuMrSCndPanrGlVVOo3JR6zofZZlKMtyN+QkjlFWNZoshPfpbyTjbzvFQx+kJBhAIaAIsK6R5zmCIDA+G+XIti47aCYa6XRRm/ZFoRFf4iG6DnITMulPjHcY2kPU56zRmjZa4ZMsw93ZGZYfPiA4PUVbVaAuKTg/XjaOZd+760cbzZXUGsVkgvD8HNOPH8ELBmqzRtOmOQ5IDlrbO73fiWiWMIZ7f4YoSlHVAmXFofVwCEgZC8MQR3ukuddr8dPgHLdXf2F++w7+zxNky6+7SaGwiD5dp+3wj41WMlTMx8K/QVX4Zn3wJ0UhEjDfCE0fMJnmHJIxKBJ/0y87PUAqjRWrsGniu/1wv1NbLYVS8D5/xuTpUyxvboyGVtvtNmf74b9heTMJIBFiZAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Build Hooks\"\n        title=\"Build Hooks\"\n        src=\"/static/5e4d92bd1bd610220f9f984938491116/37523/4_build_hooks.png\"\n        srcset=\"/static/5e4d92bd1bd610220f9f984938491116/e9ff0/4_build_hooks.png 180w,\n/static/5e4d92bd1bd610220f9f984938491116/f21e7/4_build_hooks.png 360w,\n/static/5e4d92bd1bd610220f9f984938491116/37523/4_build_hooks.png 720w,\n/static/5e4d92bd1bd610220f9f984938491116/302a4/4_build_hooks.png 1080w,\n/static/5e4d92bd1bd610220f9f984938491116/f213e/4_build_hooks.png 1192w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>Build Hooks 과정</em></p>\n<h3 id=\"output-generation-hooks\" style=\"position:relative;\"><a href=\"#output-generation-hooks\" aria-label=\"output generation hooks permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://rollupjs.org/plugin-development/#output-generation-hooks\">Output Generation Hooks</a></h3>\n<p>출력 생성 단계는 번들을 생성하고 최종 출력을 준비하는 중요한 과정으로, 이 단계에서도 다양한 훅이 호출됩니다. 출력 생성 훅을 통해 번들이 만들어지는 방식과 최종 결과물을 커스터마이징할 수 있습니다. 주요 출력 생성 훅은 다음과 같습니다.</p>\n<ul>\n<li><code>renderStart</code>: 출력 생성이 시작되기 전에 호출됩니다.</li>\n<li><code>banner</code>: 번들의 맨 앞부분에 배너를 추가할 때 사용됩니다.</li>\n<li><code>renderChunk</code>: 각 청크가 렌더링될 때 호출되며, 청크의 내용을 수정할 수 있습니다.</li>\n<li><code>generateBundle</code>: 번들이 생성된 후 호출되며, 최종 번들에 대한 추가 작업을 수행할 수 있습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 193.33333333333331%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAnCAYAAAAPZ2gOAAAACXBIWXMAABYlAAAWJQFJUiTwAAADu0lEQVRIx6VWa2/bNhT1//8b7Yd2GNoNw7AN27KsC5A2zbp2aOMhSWVHthbJelOkKD6kM5B6QHasuMkIEJJN3sNz7z33UrNGaZRZjoJSaK3BOQdjDE3TwAz73J3tAvaNmRYc66s53JUHYoCjCFEUD2BN/2zqbo4O2gfY1BJx6IFShrqu0dS1fVqjCcMpMAs4tdCyag35zRzJ+99ALk7RCH6AYWe4O8dGIlgi+ecM3L1AI8X9gDgwekOSF6N8tLF9MGAPVlxdYfH0KaJXv6M+mJTRhinXS0pxPZ8jDoK9e8cHdDFsdTXesDvSLIPS+mACZ/t0pbWCEMIKPEkSxHGM5dIFLSiUUpBS2iIwc2xn3gdASkt4ax/+7QYkN0AZ8jxHVVVWl2XJbRWZYX4b4B7czBHDVsQyc+BdvID78RsEl99B5c6WW4axmfsSYpga0G2XRQZVLKCZC0kc1FXalW6XmLK0bPfFzswB8FAp2c1KIktz+LcBlGpdNO5u7bnDcKsBtGEwRpRSy26z2WCxWMB1XeRZG1uz1sdvi+GUoE2W+0ZR1xpJnKIoii01GND+8HsBDaZhRhnHrR9htfZRVcKWXJwQkIIPh6ZpivV6bZMzzbBpwMoKinrYOL8iWhwBmkORhf29WRyBRx9Rdl70CZvtls94lryCZgGS1RvEN6eAriCJi3R9huzfc5TRJRhlrez2JWW3rWdZNrxLZdwrIVUNygQI4aiERtVpc69szNNQF1Vlyy0IQoRhiKIgkFJYo1pr0KJAmmY2ZpOyKTlHkqZ2YROGQ0zMuqnnPCe29LKc7BX3Hdm4r39A8Ok1dMXgHD2DpOlgFHw6RXT1FzSncI6/huR06+bbZtjXapGgSDaoeAmy8VAyOoRClQSCESgpUIS3aGpt5dM3CRuKTq+zcTJ03UAICcYrqy0TP9NxPM+38aSMQSjTCNr2ZsDGLcy2r0NXozG0iSHEXqxT+3Y6djPd2gFsohhxmh28KrYYTrV0Fq5w/epbrP40lSL/30VvRlWkiK4/wJu/A6PF4U+R+8BsK5MCJE0RBT58bz10lQcD2u2CI3nzPW6Pn8M/fobK+TAc9DCXe4adtrRUUFa4zSNdHhmU4QrB/AzR5TvIsriTtF3gg1mOP/+N9fnP8M5/Ac+iOyBfBLi7WdSAaPBF34kHZVOuV/j81XOsfvoRylxWf5xg9fIl2I37MIZDY2AMZLkE8/1Wl1GEzHGgusvpUS7b7h2GSJZLJB3wo13upRO9fQvnyRMEJydb/+8y/A/LPO71AyuImQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Output Generation Hooks\"\n        title=\"Output Generation Hooks\"\n        src=\"/static/03046906712457e720c5efd07ac6f185/37523/5_output_generation_hooks.png\"\n        srcset=\"/static/03046906712457e720c5efd07ac6f185/e9ff0/5_output_generation_hooks.png 180w,\n/static/03046906712457e720c5efd07ac6f185/f21e7/5_output_generation_hooks.png 360w,\n/static/03046906712457e720c5efd07ac6f185/37523/5_output_generation_hooks.png 720w,\n/static/03046906712457e720c5efd07ac6f185/774b6/5_output_generation_hooks.png 738w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>Output Generation Hooks 과정</em></p>\n<h2 id=\"3-플러그인-개발\" style=\"position:relative;\"><a href=\"#3-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8-%EA%B0%9C%EB%B0%9C\" aria-label=\"3 플러그인 개발 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 플러그인 개발</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACPklEQVQ4y3WU2ZLbIBBF54fnIb+Wt/mGvGcmS5WTuGxJ1oaExCq4qds2jjxTwXWr20Af6Ab01LUdjFkxz7NYa62I/rr+X8uyIISAt9dXfHp+xueXFwxmxVNKCdY5qElD6xXLukAvK1YbAGSknME5OWfwRx/0b338T3CMUfwnALDrhPr0DUN3xNBe0PcdQspAAlK8BoawIfgNGYCPmyyUYxTtmwC9URiqr1DtAcP5jK46QfU9qkOFsR6QfMYyBSwqwNiI0XisYUNk2tOEtF0X4sIC7IcBr2/f8ev3HwzDgHEcoZQSy3ruG9ML3sM5B+c9vPfXMuyBDLpcGqhxfCi61loOa5omsSll6acIZJx3TkAPQGOM7Kzv+/vu9iKYEDaOc15ZiGMfgJx0PB4lyN/SkJScu//nbpgaAeznXEJZgg9ADpxOJ1RVhfP5fLfso+hzQWZCcYFt2wRWQB9SbpoGXddJOhR9lqFtWxF9QqRuN2DZdYHdgTyEuq4lkGAC9wdCn2Kwu51q2eF+dw8pHw4HCS6TaYvKZDY9z1Lz0vZjd6CzVmAsdLkixfKUy+Ew4MvPHzDO/buYGQ91FOAwjqib5v4uqVKb963VCiZaLEZjdQt88kj53cWO3mORlzGIlBpheblXg3m5Wr0YhMB3mxDtiuXSwM4Km7fIaXsEemPRnRt0dYu+Uxj7CWqYoKYZ06wxa41pmiXt26PdpZyvX5+bL8AQI4zjBY7wLoic84ghYItRPk3l81TKVg4jlzLe/L8+NidMRAromgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"rollup-plugin-preserve-use-client\"\n        title=\"rollup-plugin-preserve-use-client\"\n        src=\"/static/d0c95547c5236d2c39cee927df0989e1/37523/6_rollup_plugin_preserve_use_client.png\"\n        srcset=\"/static/d0c95547c5236d2c39cee927df0989e1/e9ff0/6_rollup_plugin_preserve_use_client.png 180w,\n/static/d0c95547c5236d2c39cee927df0989e1/f21e7/6_rollup_plugin_preserve_use_client.png 360w,\n/static/d0c95547c5236d2c39cee927df0989e1/37523/6_rollup_plugin_preserve_use_client.png 720w,\n/static/d0c95547c5236d2c39cee927df0989e1/302a4/6_rollup_plugin_preserve_use_client.png 1080w,\n/static/d0c95547c5236d2c39cee927df0989e1/07a9c/6_rollup_plugin_preserve_use_client.png 1440w,\n/static/d0c95547c5236d2c39cee927df0989e1/f291a/6_rollup_plugin_preserve_use_client.png 2258w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<em>rollup-plugin-preserve-use-client 플러그인 완성✨</em></p>\n<p>플러그인을 개발하기 전, <code>preserveModules</code> 옵션을 <code>false</code>로 사용하면서 클라이언트 컴포넌트에만 <code>'use client'</code> 디렉티브를 유지하는 것이 목표로 삼았습니다. 이를 위해 Rollup의 훅을 어떻게 활용할지, 그리고 디렉티브를 탐지하고 유지하는 방법과 위에서 살펴본 <a href=\"https://github.com/rollup/rollup/issues/4699\">#4699</a> 이슈의 <a href=\"https://github.com/lukastaegert\"><strong>@lukastaegert</strong></a> <strong>우려를 최소화 할 수 있는 방법</strong>이 무엇일지 고민했습니다.</p>\n<p>이에 적용한 방법은 아래와 같습니다.</p>\n<p><strong>1. <code>moduleParsed</code> 훅을 통한 초기 모듈 식별</strong></p>\n<ul>\n<li><code>moduleParsed</code> 훅을 통해 Rollup이 각 모듈을 파싱할 때 <code>'use client'</code> 디렉티브가 포함된 모듈을 식별하고, 해당 모듈의 ID를 <code>useClientFiles</code>라는 집합(Set)에 저장합니다.</li>\n<li>이렇게 하면 <code>'use client'</code> 디렉티브가 필요한 모듈들을 미리 식별하여 저장합니다.</li>\n</ul>\n<p><strong>2. <code>generateBundle</code> 훅을 통한 청크별 모듈 검사</strong></p>\n<ul>\n<li><code>generateBundle</code> 훅에서는 최종 생성된 각 청크를 순회하며, 청크에 포함된 모든 모듈의 ID를 검사합니다. 여기서 청크에 포함된 모듈 ID 중 하나라도 <code>useClientFiles</code>에 포함된 ID가 있다면, 그 청크 상단에만 <code>'use client';</code> 지시문을 추가합니다.</li>\n<li>이 방식은 <strong>필요한 청크에만</strong> <code>'use client'</code>를 삽입하므로, 불필요하게 모든 청크에 일괄적으로 지시문이 추가되는 일을 방지합니다.</li>\n</ul>\n<p>제가 작성한 플러그인 코드는 아래와 같으며, <a href=\"https://tsup.egoist.dev/\"><code>tsup</code></a>을 사용해 빠르게 번들링하고 npm에 배포해 보았습니다.</p>\n<ul>\n<li><a href=\"https://www.npmjs.com/package/rollup-plugin-preserve-use-client\"><strong>rollup-plugin-preserve-use-client</strong></a></li>\n<li><a href=\"https://github.com/soobing/rollup-plugin-preserve-use-client#readme\"><strong>github repo</strong></a></li>\n</ul>\n<pre class=\"grvsc-container default-dark\" data-language=\"tsx\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> </span><span class=\"mtk12\">type</span><span class=\"mtk1\"> { </span><span class=\"mtk12\">Plugin</span><span class=\"mtk1\"> } </span><span class=\"mtk15\">from</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&#39;rollup&#39;</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">export</span><span class=\"mtk1\"> </span><span class=\"mtk15\">default</span><span class=\"mtk1\"> </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">preserveUseClientDirective</span><span class=\"mtk1\">(): </span><span class=\"mtk10\">Plugin</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">useClientFiles</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Set</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">string</span><span class=\"mtk1\">&gt;();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">name:</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&#39;preserve-use-client-directive&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">moduleParsed</span><span class=\"mtk1\">({ </span><span class=\"mtk12\">ast</span><span class=\"mtk1\">, </span><span class=\"mtk12\">id</span><span class=\"mtk1\"> }) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">ast</span><span class=\"mtk1\"> &amp;&amp; </span><span class=\"mtk12\">ast</span><span class=\"mtk1\">.</span><span class=\"mtk12\">body</span><span class=\"mtk1\"> &amp;&amp; </span><span class=\"mtk12\">ast</span><span class=\"mtk1\">.</span><span class=\"mtk12\">body</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">]?.</span><span class=\"mtk12\">type</span><span class=\"mtk1\"> === </span><span class=\"mtk8\">&#39;ExpressionStatement&#39;</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">expression</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">ast</span><span class=\"mtk1\">.</span><span class=\"mtk12\">body</span><span class=\"mtk1\">[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">].</span><span class=\"mtk12\">expression</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">expression</span><span class=\"mtk1\">.</span><span class=\"mtk12\">type</span><span class=\"mtk1\"> === </span><span class=\"mtk8\">&#39;Literal&#39;</span><span class=\"mtk1\"> &amp;&amp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">expression</span><span class=\"mtk1\">.</span><span class=\"mtk12\">value</span><span class=\"mtk1\"> === </span><span class=\"mtk8\">&#39;use client&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        ) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">useClientFiles</span><span class=\"mtk1\">.</span><span class=\"mtk11\">add</span><span class=\"mtk1\">(</span><span class=\"mtk12\">id</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">generateBundle</span><span class=\"mtk1\">(</span><span class=\"mtk12\">options</span><span class=\"mtk1\">, </span><span class=\"mtk12\">bundle</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">const</span><span class=\"mtk1\"> [, </span><span class=\"mtk12\">fileData</span><span class=\"mtk1\">] </span><span class=\"mtk4\">of</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Object</span><span class=\"mtk1\">.</span><span class=\"mtk11\">entries</span><span class=\"mtk1\">(</span><span class=\"mtk12\">bundle</span><span class=\"mtk1\">)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">fileData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">type</span><span class=\"mtk1\"> === </span><span class=\"mtk8\">&#39;chunk&#39;</span><span class=\"mtk1\"> &amp;&amp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">fileData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">moduleIds</span><span class=\"mtk1\">.</span><span class=\"mtk11\">some</span><span class=\"mtk1\">((</span><span class=\"mtk12\">id</span><span class=\"mtk1\">) </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">useClientFiles</span><span class=\"mtk1\">.</span><span class=\"mtk11\">has</span><span class=\"mtk1\">(</span><span class=\"mtk12\">id</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        ) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">fileData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">code</span><span class=\"mtk1\"> = </span><span class=\"mtk8\">`&#39;use client&#39;;</span><span class=\"mtk6\">\\n</span><span class=\"mtk4\">${</span><span class=\"mtk12\">fileData</span><span class=\"mtk1\">.</span><span class=\"mtk12\">code</span><span class=\"mtk4\">}</span><span class=\"mtk8\">`</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  };</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3 id=\"4-마무리\" style=\"position:relative;\"><a href=\"#4-%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"4 마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 마무리</h3>\n<p>Rollup 플러그인을 직접 개발해보니, 번들링 과정에 대해 깊이 이해할 수 있었습니다. 플러그인 개발이 매우 어렵고 특별한 지식이 필요할 거라 생각했지만, 실제로 플러그인은 간단한 함수이며 Rollup에서 제공하는 다양한 훅을 활용하면 원하는 기능을 쉽게 구현할 수 있음을 경험할 수 있었습니다. 오랜만에 오픈소스에 기여하게 되어 기쁘고, 이 코드가 많은 사람에게 유용하게 쓰이길 바라는 기대감과 테스트 코드도 하루빨리 추가해야겠다는 숙제를 남겨두며 이 글을 마칩니다.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk10 { color: #4EC9B0; }\n  .default-dark .mtk7 { color: #B5CEA8; }\n  .default-dark .mtk6 { color: #D7BA7D; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"date":"November 10, 2024","title":"Rollup Plugin 개발기","categories":"bundler","author":"soobing"},"fields":{"slug":"/rollup-plugin-development/"}},"prev":null,"site":{"siteMetadata":{"siteUrl":"https://soobing.github.io","comments":{"utterances":{"repo":"soobing/soobing.github.io"}}}}},"pageContext":{"slug":"/css-z-index-management-variables/","nextSlug":"/rollup-plugin-development/","prevSlug":""}},
    "staticQueryHashes": ["1073350324","2938748437"]}