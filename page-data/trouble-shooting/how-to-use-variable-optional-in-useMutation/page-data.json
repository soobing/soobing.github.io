{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/trouble-shooting/how-to-use-variable-optional-in-useMutation/",
    "result": {"data":{"cur":{"id":"165efc5d-e61d-55cb-a415-702d64af4311","html":"<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p><a href=\"https://github.com/TanStack/query/issues/1077\">#1077</a> 이슈를 보면 mutateFn의 variable을 필수값으로 변경한 이력을 볼 수 있다.</p>\n<p>mutation인데 왜 variable이 없냐고? 나의 경우에는 URL의 있는 queryParams를 읽어와서 데이터를 넘겨주면 되기 때문에 useSomething hook 안에서 처리하고 싶었다.</p>\n<h2 id=\"문제상황\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9\" aria-label=\"문제상황 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제상황</h2>\n<p><code>mutate()</code> 와 같이 variable에 아무 값도 넣지 않고 mutation 함수를 호출 할 수 없다.\nTVariables 타입에 undefined도 줘보고 이래저래 별짓을 다해봐도 필수값을 optional 하게 바꿀수는 없었다.</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"tsx\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// 정의</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">export</span><span class=\"mtk1\"> </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">useSomething</span><span class=\"mtk1\"> () {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> {</span><span class=\"mtk12\">name</span><span class=\"mtk1\">} = </span><span class=\"mtk11\">useQueryParams</span><span class=\"mtk1\">(); </span><span class=\"mtk3\">// custom hook이 있다고 가정</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">useMutation</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">mutationFn</span><span class=\"mtk12\">:</span><span class=\"mtk1\"> () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">axios</span><span class=\"mtk1\">.</span><span class=\"mtk11\">post</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;/user&#39;</span><span class=\"mtk1\">, {</span><span class=\"mtk12\">name</span><span class=\"mtk1\">}),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// 사용처</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">const</span><span class=\"mtk1\"> {</span><span class=\"mtk12\">mutate</span><span class=\"mtk1\">} = </span><span class=\"mtk11\">useSomething</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">handleClick</span><span class=\"mtk1\"> = () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mutate</span><span class=\"mtk1\">(); </span><span class=\"mtk3\">// 에러 발생</span></span></span></code></pre>\n<p>에러 발생\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 501px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVklEQVQoz22Q3ZKcIBBGfZIdQFERRcD/2XEzudiqff8XOikwmSSVXJz6+mugu+mirFr65cH5+YVbIvX5jj3u1INHmw6p9UVZIaufJP/SK1aqRAhJYYKnez7p9xNjHWKwyDgivKMKI9USUeuEXCbqGFBhRM0RtUyoObzi1lrETVKkLvV+ED++o61FBk9lDOLthriJSzPiD/0P6a5UFNZ0NMuC+TixIVI5j95mlNaUqkSVJWV5femXSqWQSaW6UOoVF6MPzHFisAOdsUQf2bcD50bG0RNCwPuAMR3DMNC2Ju8q8Soo1csX2q3o6RvGbzTxgWhH3rolP973IxfrOkvfDzlOjaZpzmcpH0LMuRhjnr7ow4ZbTuLxJKwPRN1TNwZre4bBZU3FklaVzmhdZ9IKfud09kXVz6h+Q7g7ql8p3U5aw3EcbNvOum7c7+95orpu/qJp2n/8DxPS7dwODauOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"trouble.png\"\n        title=\"trouble.png\"\n        src=\"/static/7c42056008a94dcf63147142441203e5/55811/trouble.png\"\n        srcset=\"/static/7c42056008a94dcf63147142441203e5/e9ff0/trouble.png 180w,\n/static/7c42056008a94dcf63147142441203e5/f21e7/trouble.png 360w,\n/static/7c42056008a94dcf63147142441203e5/55811/trouble.png 501w\"\n        sizes=\"(max-width: 501px) 100vw, 501px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"해결\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0\" aria-label=\"해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결</h2>\n<p>실질적으로는 mute 함수에서 variable을 정의해서 넣어주는 것이기 때문에 그렇게 꼼수해결법도 아니다.</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"tsx\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// 정의</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">export</span><span class=\"mtk1\"> </span><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">useSomething</span><span class=\"mtk1\"> () {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> {</span><span class=\"mtk12\">name</span><span class=\"mtk1\">} = </span><span class=\"mtk11\">useQueryParams</span><span class=\"mtk1\">(); </span><span class=\"mtk3\">// custom hook이 있다고 가정</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">mutation</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">useApiMutation</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">mutationFn</span><span class=\"mtk12\">:</span><span class=\"mtk1\"> () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">axios</span><span class=\"mtk1\">.</span><span class=\"mtk11\">post</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;/user&#39;</span><span class=\"mtk1\">, {</span><span class=\"mtk12\">name</span><span class=\"mtk1\">}),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mutate</span><span class=\"mtk1\"> = (</span><span class=\"mtk12\">variables</span><span class=\"mtk1\"> = {}) </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk12\">mutation</span><span class=\"mtk1\">.</span><span class=\"mtk11\">mutate</span><span class=\"mtk1\">(</span><span class=\"mtk12\">variables</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> {...</span><span class=\"mtk12\">mutation</span><span class=\"mtk1\">, </span><span class=\"mtk12\">mutate</span><span class=\"mtk1\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// 사용처</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">const</span><span class=\"mtk1\"> {</span><span class=\"mtk12\">mutate</span><span class=\"mtk1\">} = </span><span class=\"mtk11\">useSomething</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk11\">handleClick</span><span class=\"mtk1\"> = () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk11\">mutate</span><span class=\"mtk1\">(); </span><span class=\"mtk3\">// 에러안남</span></span></span></code></pre>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","excerpt":"Introduction #1077 이슈를 보면 mutateFn의 variable을 필수값으로 변경한 이력을 볼 수 있다. mutation인데 왜 variable이 없냐고? 나의 경우에는 URL의 있는 queryParams를 읽어와서 데이터를 넘겨주면 되기 때문에 useSomething hook 안에서 처리하고 싶었다. 문제상황 mutate() 와 같이 variable에 아무 값도 넣지 않고 mutation 함수를 호출 할 수 없다.\nTVariables 타입에 undefined도 줘보고 이래저래 별짓을 다해봐도 필수값을 optional 하게 바꿀수는 없었다. 에러 발생\n 해결 실질적으로는 mute 함수에서 variable을 정의해서 넣어주는 것이기 때문에 그렇게 꼼수해결법도 아니다.","frontmatter":{"date":"February 15, 2023","title":"[react-query] useMutation에서 variable 옵셔널하게 사용하기","categories":"react troubleshooting","author":"soobing"},"fields":{"slug":"/trouble-shooting/how-to-use-variable-optional-in-useMutation/"}},"next":{"id":"1006ea2d-51dc-5feb-8034-3df2af785e66","html":"<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>이 글을 읽기전 <a href=\"https://soobing.github.io/react/react-state-management/\"><strong>React의 상태관리 종류 4가지</strong></a>를 먼저 읽으면 이해가 쉬울 수 있다.</p>\n<p>얼마전 회사 프로젝트에 react-query를 도입하여 사용중인데 정말 너무너무 좋다. react-query를 이용해서 server state를 분리하다보니 loading 처리나, refetch 등 불필요한 코드가 많이 줄었다.</p>\n<p>뭐든지 처음이 어렵지 큰 그림을 알고있으면 도입하여 적용하는데에는 큰 문제가 없고, 사용하면서 상황에 맞게 옵션과 아키텍쳐를 변경하면 된다고 생각하기 때문에, 이번 포스팅에서는 react-query를 적용하기 위해 필요한 전반적인 개념을 정리해보고자 한다.</p>\n<h2 id=\"용도\" style=\"position:relative;\"><a href=\"#%EC%9A%A9%EB%8F%84\" aria-label=\"용도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>용도</h2>\n<p>react-query는 서버 데이터 관리를 위한 라이브러리다.  이 라이브러리는 API 호출, 캐시 및 상태 관리, 오류 처리 등의 작업을 간단하게 처리할 수 있도록 도와준다.</p>\n<p>서버 데이터 관리는 중요한 부분 중 하나다. 클라이언트에서는 서버로부터 데이터를 가져와(Read) 화면에 그려주고, 데이터를 생성(Create), 삭제(Delete), 업데이트(Update)하는 할 수 있도록 한다.</p>\n<p>매번 API 호출를 통해서 데이터를 가져와 화면을 그릴수도 있겠지만 서버에서 데이터를 가져오는 것은 요청-응답과정이 있으므로 느리고 서버의 트래픽을 늘려 부하가 증가할 수 있으므로 최소한의 요청으로 화면을 그릴 수 있도록 최적화해야 한다. 데이터를 캐시하고, 요청을 최소화하고, 데이터를 이전 요청 결과를 재사용하여 처리 시간을 줄이는 등의 방법으로 최적화할 수 있다.</p>\n<p>react-query는 이러한 데이터 관리 작업을 간단하고 효율적으로 처리할 수 있는 방법을 제공한다. 데이터를 캐시하고, 자동으로 재시도하고, 데이터에 대한 오류 처리를 수행하며, 데이터 상태와 흐름을 추적할 수 있다. 또한, React Query는 라이브러리 사용자의 입맛에 맞게 커스터마이징이 가능하다. 이를 통해 개발자는 데이터 관리 작업에 더 많은 시간과 노력을 투자하지 않아도, 더 나은 애플리케이션을 만들 수 있다.</p>\n<p>정리하면 react-query에서 해주는일은 아래와 같다.</p>\n<ol>\n<li>API 호출\n<ul>\n<li>useQuery, useMutation을 통해서 CRUD 처리를 할 수 있습니다.</li>\n</ul>\n</li>\n<li>캐시 및 상태 관리\n<ul>\n<li>데이터에 대한 유효성 검사(캐싱하고 있는 데이터와 서버데이터 동기화)\n<ul>\n<li>특정 state 변경시 data refetch → dependency variable</li>\n<li>이벤트 발생 후에 refetch → Query Invalidation</li>\n<li>백그라운드에서 캐시된 데이터를 자동으로 업데이트</li>\n</ul>\n</li>\n<li>데이터 흐름을 추적 → debugger 제공</li>\n</ul>\n</li>\n<li>오류 처리 - 서버에서 문제가 발생했을 경우 재시도, 실패 처리 등</li>\n</ol>\n<h2 id=\"큰-개념-3가지\" style=\"position:relative;\"><a href=\"#%ED%81%B0-%EA%B0%9C%EB%85%90-3%EA%B0%80%EC%A7%80\" aria-label=\"큰 개념 3가지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>큰 개념 3가지</h2>\n<p><a href=\"https://tanstack.com/query/latest/docs/react/quick-start\">공식문서 Quick Start 섹션</a>에서도 3가지 core concept를 간략하게 설명하고 있다. 이 3가지 개념만 이해하면 처음 도입하는데 문제가 없고 왠만한 CRUD 케이스는 거의 커버가 가능하다.</p>\n<p>공식문서에 있는 예제를 가져왔다. 먼저  <code>QueryClientProvider</code> 를 통해서 <code>QueryClient</code> App 전체에 주입한다. todos와 관련된 get 요청은 useQuery를 통해서 fetching 하고, todos를 create하는 요청은 useMutation을 통해서 하며, 성공시 이전에 get요청을 통해 가져왔던 todos를 다시 reffetching 해야하므로 invalidateQueries를 통해서 어떤 query가 stale 되었는지 체크를 해준다. 상태값이 변경되면 리렌더 되듯이, queryKey를 통해서 stale 상태를 만들면 다시 refetching 하고 관련 data를 rerendering 하는 것이 큰 컨셉이다.</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"tsx\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">useQuery</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">useMutation</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">useQueryClient</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">QueryClient</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">QueryClientProvider</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">} </span><span class=\"mtk15\">from</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&#39;@tanstack/react-query&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk15\">import</span><span class=\"mtk1\"> { </span><span class=\"mtk12\">getTodos</span><span class=\"mtk1\">, </span><span class=\"mtk12\">postTodo</span><span class=\"mtk1\"> } </span><span class=\"mtk15\">from</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&#39;../my-api&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// Create a client</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">queryClient</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">new</span><span class=\"mtk1\"> </span><span class=\"mtk10\">QueryClient</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">App</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Provide the client to your App</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk10\">QueryClientProvider</span><span class=\"mtk1\"> </span><span class=\"mtk12\">client</span><span class=\"mtk1\">=</span><span class=\"mtk4\">{</span><span class=\"mtk12\">queryClient</span><span class=\"mtk4\">}</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk17\">&lt;</span><span class=\"mtk10\">Todos</span><span class=\"mtk1\"> </span><span class=\"mtk17\">/&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk10\">QueryClientProvider</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Todos</span><span class=\"mtk1\">() {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// Access the client</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">queryClient</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">useQueryClient</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// Queries</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">query</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">useQuery</span><span class=\"mtk1\">({ </span><span class=\"mtk12\">queryKey:</span><span class=\"mtk1\"> [</span><span class=\"mtk8\">&#39;todos&#39;</span><span class=\"mtk1\">], </span><span class=\"mtk12\">queryFn:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">getTodos</span><span class=\"mtk1\"> })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// Mutations</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">mutation</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">useMutation</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">mutationFn:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">postTodo</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk11\">onSuccess</span><span class=\"mtk12\">:</span><span class=\"mtk1\"> () </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\">// Invalidate and refetch</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">queryClient</span><span class=\"mtk1\">.</span><span class=\"mtk11\">invalidateQueries</span><span class=\"mtk1\">({ </span><span class=\"mtk12\">queryKey:</span><span class=\"mtk1\"> [</span><span class=\"mtk8\">&#39;todos&#39;</span><span class=\"mtk1\">] })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk15\">return</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">div</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">ul</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">{</span><span class=\"mtk12\">query</span><span class=\"mtk1\">.</span><span class=\"mtk12\">data</span><span class=\"mtk1\">?.</span><span class=\"mtk11\">map</span><span class=\"mtk1\">((</span><span class=\"mtk12\">todo</span><span class=\"mtk1\">) </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">li</span><span class=\"mtk1\"> </span><span class=\"mtk12\">key</span><span class=\"mtk1\">=</span><span class=\"mtk4\">{</span><span class=\"mtk12\">todo</span><span class=\"mtk1\">.</span><span class=\"mtk12\">id</span><span class=\"mtk4\">}</span><span class=\"mtk17\">&gt;</span><span class=\"mtk4\">{</span><span class=\"mtk12\">todo</span><span class=\"mtk1\">.</span><span class=\"mtk12\">title</span><span class=\"mtk4\">}</span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">li</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        ))</span><span class=\"mtk4\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">ul</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk17\">&lt;</span><span class=\"mtk4\">button</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">onClick</span><span class=\"mtk1\">=</span><span class=\"mtk4\">{</span><span class=\"mtk1\">() </span><span class=\"mtk4\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk12\">mutation</span><span class=\"mtk1\">.</span><span class=\"mtk11\">mutate</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">id:</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Date</span><span class=\"mtk1\">.</span><span class=\"mtk11\">now</span><span class=\"mtk1\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">title:</span><span class=\"mtk1\"> </span><span class=\"mtk8\">&#39;Do Laundry&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span><span class=\"mtk4\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        Add Todo</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">button</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk17\">&lt;/</span><span class=\"mtk4\">div</span><span class=\"mtk17\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">render</span><span class=\"mtk1\">(</span><span class=\"mtk17\">&lt;</span><span class=\"mtk10\">App</span><span class=\"mtk1\"> </span><span class=\"mtk17\">/&gt;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">document</span><span class=\"mtk1\">.</span><span class=\"mtk11\">getElementById</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;root&#39;</span><span class=\"mtk1\">))</span></span></span></code></pre>\n<p>이번에는 조금 더 자세히 3가지 개념에 대해서 알아보자.</p>\n<h3 id=\"1-queries\" style=\"position:relative;\"><a href=\"#1-queries\" aria-label=\"1 queries permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1) Queries</h3>\n<p>Queries는 React Query에서 데이터를 <strong>가져오는데</strong> 사용된다. 일반적으로 REST API 호출, GraphQL 쿼리, Websocket 등을 통해 데이터를 가져올 수 있다. Query는 <code>useQuery</code> 훅을 사용한다. useQuery는 비동기적으로 데이터를 가져오고, 데이터를 캐싱하여 이후의 요청에서 동일한 데이터를 다시 가져오지 않도록 한다. 또한, Query 컴포넌트는 로딩 중, 에러 발생 시에도 적절한 UI를 렌더링할 수 있도록 지원한다.</p>\n<h3 id=\"2-mutations\" style=\"position:relative;\"><a href=\"#2-mutations\" aria-label=\"2 mutations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2) Mutations</h3>\n<p>Mutations는 React Query에서 데이터를 <strong>수정</strong>하거나 <strong>삭제</strong>하는데 사용된다. REST API 호출, GraphQL Mutation 등을 통해 데이터를 수정하고, <code>useMutation</code> 훅을 사용한다. useMutation은 비동기적으로 데이터를 수정하고, 데이터를 업데이트하여 UI를 다시 렌더링한다.</p>\n<h3 id=\"3-query-invalidation\" style=\"position:relative;\"><a href=\"#3-query-invalidation\" aria-label=\"3 query invalidation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3) Query Invalidation</h3>\n<p>Query Invalidation은 React Query에서 <strong>캐시된 데이터를 무효화하는데 사용</strong>된다. 일반적으로 데이터가 수정되거나 삭제되었을 때, 해당 데이터를 다시 가져와서 캐시를 업데이트한다. React Query는 Query Invalidation을 자동으로 처리하며, useMutation 훅을 사용하여 데이터를 수정하면, 해당 데이터를 가져오는 모든 Query를 자동으로 무효화한다. 또한, useQuery 훅에서 제공하는 여러 가지 옵션을 사용하여 수동으로 Query Invalidation을 제어할 수 있다.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk10 { color: #4EC9B0; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk17 { color: #808080; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"date":"February 05, 2023","title":"react-query 시작하기 (feat. Tanstack)","categories":"react","author":"soobing"},"fields":{"slug":"/react/react-query-basic/"}},"prev":{"id":"77244793-f1ae-56d8-adea-558b747f6cc1","html":"<p>React 18로 버전업 하면서 프로젝트에 Recoil을 도입했는데, 그 과정에서 고민했던 내용을 기록차 남겨본다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACgUlEQVQoz22SS2sTARSF81NcuXSh4kaK4EYr4kJFdOuiiqjgQoSCqFQFceGqCxVBQRBaBF/V2ja179ok5tE2TeMkNdN0JjOZTJN5JZlJMp8kbX2gFy6XC4ePcy430Gr5hOMasSWdRHKTbM6kuKBQiKikFlQWF1SiyzqJzCYzayW+SUVGZJmwKjFWFNBqFu3yfb8zA22gZXvYtoem17CqDYpJDSmmkEuVScVLzEc0VvObDK2uE5EUhnMic0qON/klqg33byD/KUd3KOdNpGSJbMYkKxiEfigktSIRqUBMkfmqiCzrckff2ob5+ARqtTrlioFtO5iWjVExUbIqRbXCypxIMioTWhYJxrLMZ0SmsgLjwiqqZSIYWgfUbLVobXeg2WxSLld+WW64TRzNxtRdNvI20dksk0sCMwmJeL7IbCHHml5GKMiky8o/6TqRXdfFsuwtYL2BWbAQMzoZQWdRlJmJCCwsrzO6mEayTErVOt/1EmlVIpSM8CkyzsjkB4a/vCew48xxqnieh9/0EcMbvHoc5/nnKP3RbwwnUgyMzzH2Mc/gRJRJIc07YRWhUmQsFOTe7StcON1N3+XzW8AO1IdavYZTsom9TvPoQZybAyFuTY/Sn54mHEwy0LfIgydRet9+4e70CGFdZGRqiBtHunh69jjPrl7airzjsuW3MEoGckJjIigzsaISXM8SNzZwFJvZFxkGB/P0T6Z4thIhbsjcvHOfEycvcqr7DPv2HPgdeWd27mlbVKs13Hodx9maXsPD9Vxsu4rjOJQNs6O93vuQg9097OrqYff+o387/BPa7rrr4rner7194/ZXtN9jR3vv0UuOnbnG7sOX2XvoHD8BCyEP5FdvRw4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"atoms\"\n        title=\"atoms\"\n        src=\"/static/bacfc19ebc3abbd16907982695c8d6b5/37523/atoms.png\"\n        srcset=\"/static/bacfc19ebc3abbd16907982695c8d6b5/e9ff0/atoms.png 180w,\n/static/bacfc19ebc3abbd16907982695c8d6b5/f21e7/atoms.png 360w,\n/static/bacfc19ebc3abbd16907982695c8d6b5/37523/atoms.png 720w,\n/static/bacfc19ebc3abbd16907982695c8d6b5/302a4/atoms.png 1080w,\n/static/bacfc19ebc3abbd16907982695c8d6b5/21b4d/atoms.png 1280w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"tldr\" style=\"position:relative;\"><a href=\"#tldr\" aria-label=\"tldr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TL;DR;</h2>\n<p>개념 정리나 장단점 비교에 대해서는 이미 알고 계신분들도 있을 것 같아서 폴더구조나 Redux를 대체하는게 맞는가에 대해서만 먼저 간단하게 요약한 내용을 공유한다.</p>\n<h3 id=\"1-폴더-구조는-data-source-별로-나누자\" style=\"position:relative;\"><a href=\"#1-%ED%8F%B4%EB%8D%94-%EA%B5%AC%EC%A1%B0%EB%8A%94-data-source-%EB%B3%84%EB%A1%9C-%EB%82%98%EB%88%84%EC%9E%90\" aria-label=\"1 폴더 구조는 data source 별로 나누자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 폴더 구조는 data source 별로 나누자</h3>\n<ul>\n<li><a href=\"https://github.com/facebookexperimental/Recoil/issues/27\">Suggested folder structure for atoms and selectors</a>\n<ul>\n<li><code>recoil</code> 폴더 하위에 <code>data source</code> 별로 나누자</li>\n<li><code>data source</code> 하위에 <code>atoms, selectors, hooks</code>를 두자</li>\n</ul>\n<pre class=\"grvsc-container default-dark\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">├── App.tsx</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">├── index.tsx</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">└── src</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ├── components</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    │   └── TodoItem.tsx</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    └── recoil</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        |── todo</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            └── atoms.ts</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            └── selectors.ts</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            └── useTodo.ts</span></span></code></pre>\n</li>\n</ul>\n<h3 id=\"2-concurrency-mode-사용하려면-redux는-버리고-recoil로-넘어가야하나\" style=\"position:relative;\"><a href=\"#2-concurrency-mode-%EC%82%AC%EC%9A%A9%ED%95%98%EB%A0%A4%EB%A9%B4-redux%EB%8A%94-%EB%B2%84%EB%A6%AC%EA%B3%A0-recoil%EB%A1%9C-%EB%84%98%EC%96%B4%EA%B0%80%EC%95%BC%ED%95%98%EB%82%98\" aria-label=\"2 concurrency mode 사용하려면 redux는 버리고 recoil로 넘어가야하나 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. concurrency mode 사용하려면 Redux는 버리고 Recoil로 넘어가야하나?</h3>\n<ul>\n<li><a href=\"https://github.com/reactwg/react-18/discussions/86\">useSyncExternalStore</a> hook 을 사용해서 Redux에서도 동시성 모드를 사용할 수 있다.</li>\n<li>이 부분에 대해서 고민해 본 내용은 아래에..</li>\n</ul>\n<h2 id=\"recoil-도입-배경\" style=\"position:relative;\"><a href=\"#recoil-%EB%8F%84%EC%9E%85-%EB%B0%B0%EA%B2%BD\" aria-label=\"recoil 도입 배경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recoil 도입 배경</h2>\n<p>Recoil은 Facebook에서 개발한 상태 관리 라이브러리다. 이전에는 Facebook에서 React 애플리케이션의 상태 관리를 위해 <a href=\"https://github.com/facebookarchive/flux\">Flux 아키텍처</a>를 구현한 Redux, MobX와 같은 라이브러리를 사용했었다. (사실 아직도 사용하는 곳이 많음) 그러나 아래 표를 보면 알겠지만, Flux 아키텍처를 구현하기위해서 복잡하고 번거로운 코드를 작성해야하므로 Facebook은 더 간편하고 직관적인 상태 관리 라이브러리를 고민하게 됬다고 한다.</p>\n<ul>\n<li>번거로운 코드?\n<ul>\n<li>Redux를 예시로 설명하면 애플리케이션의 상태를 하나의 객체로 관리하고, 상태 변경을 발생시키는 액션(Action)과 상태 변경을 처리하는 리듀서(Reducer)를 사용하여 데이터를 관리하므로 이와 관련된 코드들이 추가적으로 필요하다.</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB20lEQVQoz42PTU8TURSGZ+nvcOHGHyALja4MIZEViQtiiDFqFEGiEXWrmGAkmugGU0KhpRFjwFJpbRuS2lKt05aRjm2pWmnptzNtofNx56P33mMQywqiz+rkJOc878vA4VBKAQAhxHFcPBaLsmy1UtnfAwBDCMWYYEwopZRQggluYwBQ0ynRYTe+8l+SqfN9fRf6+8/19FimrLpcXvOO8cHnOmoxBxoBQK/VhNWQVio1W633Ho/f53vncmW+/dDVeib+JptYbhuI2czlA8FwKBxRNTWXrgSXuE+ehKLoZn5z5+OqHP2MVfVvh72nivh9bT6f9hLcZqas9otXhgYuDSazGcdT//DZiZHuiWS6vG2frt64Vrp1UytsEQBzFx0Acvzi7N0j8w+PSs0iw0bjlmmbddYhNOp8JGt/4l6YXBEbsrzOFebmqs63piR1zAQAtmsbrPPOun/c0CQG/gMFGbWG3JQQAJgY/xTKxcYvSilDO3R6UUx2Z3d447Et8OxVSFLQo5nA6UFL7+iMrJBwKnDqflfvWHdJLB5gJn+OLU524MHrq+ML1frO7ReersuTZ66/FJrGSsJ3fOjYyXsnCsLWP2LvJYrweZs75vzAm21al0QXu+TnvJqBfgOAkP9oPAI3lQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flux\"\n        title=\"flux\"\n        src=\"/static/4e61d149ddd7fd2414a0838c10bbc1d9/37523/flux.png\"\n        srcset=\"/static/4e61d149ddd7fd2414a0838c10bbc1d9/e9ff0/flux.png 180w,\n/static/4e61d149ddd7fd2414a0838c10bbc1d9/f21e7/flux.png 360w,\n/static/4e61d149ddd7fd2414a0838c10bbc1d9/37523/flux.png 720w,\n/static/4e61d149ddd7fd2414a0838c10bbc1d9/302a4/flux.png 1080w,\n/static/4e61d149ddd7fd2414a0838c10bbc1d9/07a9c/flux.png 1440w,\n/static/4e61d149ddd7fd2414a0838c10bbc1d9/82747/flux.png 2232w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Recoil은 React의 Hook 기능을 사용하여 상태를 관리하므로 코드를 간결하고 직관적으로 작성할 수 있다. 또한, 상태의 종속성 관계를 자동으로 추적하고 캐싱하여 상태 변경이 발생할 때 효율적인 업데이트를 수행할 수 있다. 이러한 이유로 Recoil은 React 애플리케이션에서 Global 상태 관리를 위한 매우 간편하고 유연한 도구로 인기를 얻고 있다.</p>\n<h2 id=\"recoil-장단점\" style=\"position:relative;\"><a href=\"#recoil-%EC%9E%A5%EB%8B%A8%EC%A0%90\" aria-label=\"recoil 장단점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recoil 장단점</h2>\n<h3 id=\"장점\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EC%A0%90\" aria-label=\"장점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장점</h3>\n<ol>\n<li>편리한 비동기 처리\n<ul>\n<li>비동기 처리를 위한 복잡한 중간 처리기 작성 필요 없음\n<ul>\n<li>보통 redux-thunk, redux-saga, redux-observable 등의 별도의 라이브러리를 이용하여 복잡한 중간 처리기를 작성해야 했지만, Recoil에서는 이러한 복잡한 작업을 하지 않아도 된다.</li>\n</ul>\n</li>\n<li>비동기 데이터 흐름 제어 용이\n<ul>\n<li>useRecoilState나 useRecoilValue등의 API를 사용하여 비동기 데이터를 상태로 관리하면서도 간단하게 데이터 흐름을 제어할 수 있다.</li>\n</ul>\n</li>\n<li>Async/await 문법 사용 가능:\n<ul>\n<li>비동기 처리시 async/await 문법을 사용할 수 있다.</li>\n<li>redux-saga 에서는 generate로 비동기 처리 코드를 작성해야 하는데, 이와 비교해보면 코드의 가독성과 편리성이 훨씬 높다.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>유연한 상태 관리\n<ul>\n<li>atom, selector, atomFamily, selectorFamily API를 통해 쉽게 상태를 정의하고 읽고 쓸 수 있음\n<ul>\n<li>-Family: 매개변수로 파라메터 전달</li>\n</ul>\n</li>\n<li>상태 관리의 대상이 되는 컴포넌트를 명시적으로 지정할 필요 없음\n<ul>\n<li>Redux 7.1 버전 이전에는는 컴포넌트가 Redux store의 상태 값을 사용하기 위해 connect 함수를 사용하여 컴포넌트와 상태 값을 연결해주어야 했다. 그러나 이후버전 부터는 Redux에서도 <strong><code>useSelector</code>, <code>useDispatch</code></strong> 와 같은 hook을 제공</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>DevTools 지원\n<ul>\n<li>애플리케이션의 상태 변화 디버깅 가능</li>\n</ul>\n</li>\n<li>성능\n<ul>\n<li>Recoil은 Concurrency Mode를 통해 <strong>동시성 처리를 지원</strong></li>\n<li>특정 상태의 변경이 발생할 때 해당 상태를 사용하는 컴포넌트들만 다시 렌더링되도록 최적화</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"단점\" style=\"position:relative;\"><a href=\"#%EB%8B%A8%EC%A0%90\" aria-label=\"단점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>단점</h3>\n<ol>\n<li>상태 관리 패턴의 변경\n<ul>\n<li>Redux와 같은 상태 관리 라이브러리에서의 경험을 적용할 수 없으므로 러닝커브 존재</li>\n</ul>\n</li>\n<li>문서와 커뮤니티\n<ul>\n<li>Recoil은 비교적 최신 라이브러리 이므로 문서와 커뮤니티의 규모가 Redux 보다 작다.</li>\n</ul>\n</li>\n<li>다른 라이브러리와의 호환성\n<ul>\n<li>Recoil은 React와 함께 사용하기 위한 라이브러리이므로, 다른 라이브러리와 함께 사용하는 경우 호환성 문제가 발생할 수 있음.</li>\n</ul>\n</li>\n<li>상태 변화 추적\n<ul>\n<li>Recoil은 Atom과 selector에서만 상태 변화 추적을 지원하므로, 기존의 React 컴포넌트에서 상태 변화를 추적하는 것과 다른 방식으로 접근해야 할 수 있다.</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"recoil은-concurrency-mode를-지원한다고-하는데-그렇다면-redux는-버려야하나\" style=\"position:relative;\"><a href=\"#recoil%EC%9D%80-concurrency-mode%EB%A5%BC-%EC%A7%80%EC%9B%90%ED%95%9C%EB%8B%A4%EA%B3%A0-%ED%95%98%EB%8A%94%EB%8D%B0-%EA%B7%B8%EB%A0%87%EB%8B%A4%EB%A9%B4-redux%EB%8A%94-%EB%B2%84%EB%A0%A4%EC%95%BC%ED%95%98%EB%82%98\" aria-label=\"recoil은 concurrency mode를 지원한다고 하는데 그렇다면 redux는 버려야하나 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recoil은 concurrency mode를 지원한다고 하는데, 그렇다면 Redux는 버려야하나?</h2>\n<ul>\n<li>\n<p><a href=\"https://github.com/reactwg/react-18/discussions/86\">useSyncExternalStore</a> hook 사용하면 Redux를 사용하면서 concurrency mode를 사용할 수 있다.</p>\n<ul>\n<li><code>Redux + useSyncExternalStore</code> 관련 자료\n<ul>\n<li><a href=\"https://github.com/reactwg/react-18/discussions/86\">useMutableSource → useSyncExternalStore #86</a></li>\n<li><a href=\"https://dev.to/sebastienlorber/react-18-milestone-react-redux-adopts-usesyncexternalstore-102b\">React 18 milestone: React-Redux adopts useSyncExternalStore</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>그렇지만, useSyncExternalStore를 사용한다고 state 변경시 update 일어나는 로직이 Recoil과 동일하지는 않다.</p>\n<ul>\n<li>Redux + useSyncExternalStore 훅을 사용하는 경우, Redux의 상태 업데이트가 완료되는 시점에서 React의 렌더링이 일어나지만,</li>\n<li>Recoil은 내부적으로 React의 상태 감지 기능을 사용하여 상태 업데이트가 발생하면 즉시 React의 렌더링을 트리거한다.</li>\n<li>성능 차이는 미미하겠지만 정확히 이야기하면 Recoil은 Redux보다 더 빠른 상태 업데이트와 더 높은 성능을 제공할 수 있다.</li>\n</ul>\n</li>\n<li>\n<p>추가적으로, concurrency mode 이외에도 Redux와 Recoil는 차이점이 존재한다.</p>\n<p>위에서 비교한 장단점 코너와 중복되는 이야기가 많으므로 간략하게만 이야기하면..</p>\n<ul>\n<li>Redux의 flux 패턴은 Recoil의 atom/select 패턴과 비교했을때 추가적인 코드가 더 많이 필요</li>\n<li>Redux는 비동기 데이터 흐름을 제어하기 위한 API를 제공하지 않는다. → redux-saga와 같은  middleware를 사용해야 한다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"내-생각\" style=\"position:relative;\"><a href=\"#%EB%82%B4-%EC%83%9D%EA%B0%81\" aria-label=\"내 생각 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>내 생각</h3>\n<ul>\n<li>신규 프로젝트이고 React 18을 사용한다면 Recoil을 한번 사용해보는 것을 추천한다.</li>\n<li>기존 프로젝트에서 이미 Redux를 사용중이고 React 18 버전을 사용한다면, useSyncExternalStore를 사용하여 concurrency mode를 함께 사용해보면 좋을 것 같다.</li>\n</ul>\n<h2 id=\"개념정리\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EB%85%90%EC%A0%95%EB%A6%AC\" aria-label=\"개념정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개념정리</h2>\n<p>정확한 개념은 <a href=\"https://recoiljs.org/ko/docs/introduction/motivation/\">공식문서</a>를 참고하도록 하자. 간략하게 전반적인 개념정리를 하기 위한 코너.</p>\n<h3 id=\"state\" style=\"position:relative;\"><a href=\"#state\" aria-label=\"state permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>State</h3>\n<ul>\n<li>Atom, Selector\n<ul>\n<li>Atom: 가장 작은 state 단위</li>\n<li>Selector: 파생된 state. atoms나 다른 selectors를 입력으로 받아들이는 순수 함수(pure function)</li>\n<li>key값 (전역적으로) 고유해야함</li>\n</ul>\n</li>\n<li>Loadable\n<ul>\n<li>\n<p>atom 혹은 selector의 최신 상태를 대표. <code>state</code>와 <code>contents</code> 두 가지 데이터를 가짐.</p>\n<table>\n<thead>\n<tr>\n<th>state</th>\n<th>contents</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>hasValue</td>\n<td>실제 값</td>\n</tr>\n<tr>\n<td>hasError</td>\n<td>Error 객체</td>\n</tr>\n<tr>\n<td>loading</td>\n<td>toPromise()</td>\n</tr>\n<tr>\n<td>를 사용하여 값의 Promise</td>\n<td></td>\n</tr>\n<tr>\n<td>를 얻을 수 있음</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"hooks\" style=\"position:relative;\"><a href=\"#hooks\" aria-label=\"hooks permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hooks</h3>\n<ul>\n<li>state 관련\n<ul>\n<li><a href=\"https://recoiljs.org/ko/docs/api-reference/core/useRecoilState\">useRecoilState()</a>: 읽기, 쓰기 가능</li>\n<li><a href=\"https://recoiljs.org/ko/docs/api-reference/core/useRecoilValue\">useRecoilValue()</a>: 읽기 전용(getter return)</li>\n<li><a href=\"https://recoiljs.org/ko/docs/api-reference/core/useSetRecoilState\">useSetRecoilState()</a>: 쓰기 전용(setter return)</li>\n<li><a href=\"https://recoiljs.org/ko/docs/api-reference/core/useResetRecoilState\">useResetRecoilState()</a>: default state로 리셋</li>\n<li><a href=\"https://recoiljs.org/ko/docs/api-reference/core/useRecoilStateLoadable\">useRecoilStateLoadable()</a>: 비동기 selector의 값 읽기, 쓰기 가능. Loadable 객체 반환</li>\n<li><a href=\"https://recoiljs.org/ko/docs/api-reference/core/useRecoilValueLoadable\">useRecoilValueLoadable()</a>: 비동기 selector의 값 읽기 전용. Loadable 객체 반환</li>\n<li><a href=\"https://recoiljs.org/ko/docs/api-reference/core/useGetRecoilValueInfo\">useGetRecoilValueInfo()</a>: 하나의 atom 혹은 selector의 현재 상태, 값,기타 다른 정보 peek</li>\n<li><a href=\"https://recoiljs.org/ko/docs/api-reference/core/useRecoilRefresher\">useRecoilRefresher()</a>: 연관된 모든 캐시를 삭제하고 selector를 호출할 수 있는 콜백을 반환</li>\n<li><a href=\"https://recoiljs.org/ko/docs/api-reference/core/isRecoilValue\">isRecoilValue()</a>: value가 atom이나 selector일 경우 true 반환</li>\n</ul>\n</li>\n<li>concurrency mode 관련\n<ul>\n<li>useRecoilTransaction()</li>\n</ul>\n</li>\n<li>기타\n<ul>\n<li>useRecoilCallback()</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"utils\" style=\"position:relative;\"><a href=\"#utils\" aria-label=\"utils permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Utils</h3>\n<ul>\n<li><a href=\"https://recoiljs.org/ko/docs/api-reference/utils/atomFamily\">atomFamily()</a>: atom과 유사하지만, 매개변수로 전달한 키를 이용하여 동일한 상태를 가진 여러 개의 atom 생성 가능</li>\n<li><a href=\"https://recoiljs.org/ko/docs/api-reference/utils/selectorFamily/\">selectorFamily()</a>: selector와 유사하지만,  get, set, selector의 콜백을 매개변수로 전달하여 동일한 상태를 가진 여러개의 selector 생성 가능.</li>\n<li>constSelector()</li>\n<li>errorSelector()</li>\n<li>noWait()</li>\n<li>waitForAll()</li>\n<li>waitForAllSettled()</li>\n<li>waitForNone()</li>\n<li>waitForAny()</li>\n</ul>\n<h2 id=\"폴더구조\" style=\"position:relative;\"><a href=\"#%ED%8F%B4%EB%8D%94%EA%B5%AC%EC%A1%B0\" aria-label=\"폴더구조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>폴더구조</h2>\n<p><code>recoil</code> 폴더 아래 data source 별로 나누고, 하위에 <code>atoms, selectors, hooks</code> 를 두도록 폴더 구조를 설계하자. 또한 외부에서 recoil state를 사용할때 직접적으로 atoms, selectors를 접근해서 사용하는 방식이 아닌 관련 data Source의 custom hook을 접근해서 사용하는 방법을 추천하고 있다.</p>\n<p>추가적인 내의견을 덧붙이면 hook 파일의 이름은 <code>use-</code> prefix 로 짓는 것이 가독성이 높은 것 같다.</p>\n<ul>\n<li>\n<p><a href=\"https://github.com/facebookexperimental/Recoil/issues/27\">Suggested folder structure for atoms and selectors</a></p>\n<pre class=\"grvsc-container default-dark\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">├── App.tsx</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">├── index.tsx</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">└── src</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ├── components</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    │   └── TodoItem.tsx</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    └── recoil</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        |── todo</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            └── atoms.ts</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            └── selectors.ts</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            └── useTodo.ts</span></span></code></pre>\n<ul>\n<li>recoil 하위에 data source 별로 나누자</li>\n<li>data source 하위에 atoms, selectors, hooks를 두자</li>\n<li>public interface에서는 atom이나 selector를 직접 import해서 사용하는 방식이 아닌, 한번 wrapping한 hook을 통해서 사용하기</li>\n<li>\n<ul>\n<li>내의견 = hook 파일명을 <code>use-</code> prefix를 사용해서 만드는 것이 가독성이 높음</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>참고자료</p>\n<ul>\n<li><a href=\"https://wes-rast.medium.com/recoil-project-structure-best-practices-79e74a475caa\">Recoil Project Structure Best Practices</a>\n<ul>\n<li><a href=\"https://codesandbox.io/s/recoil-good-structure-iprvo?from-embed=&#x26;file=/src/recoil/example/index.ts\">좋은 예시</a>, <a href=\"https://codesandbox.io/s/recoil-bad-structure-91l7c?from-embed\">나쁜 예시</a></li>\n<li>가져올만한 교훈 = data source 별로 나누자</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"참고\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0\" aria-label=\"참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고</h2>\n<ul>\n<li><a href=\"https://recoiljs.org/\">https://recoiljs.org/</a></li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"date":"April 08, 2023","title":"Recoil 도입기(feat. 폴더구조)","categories":"react","author":"soobing"},"fields":{"slug":"/react/recoil-introduction/"}},"site":{"siteMetadata":{"siteUrl":"https://soobing.github.io","comments":{"utterances":{"repo":"soobing/soobing.github.io"}}}}},"pageContext":{"slug":"/trouble-shooting/how-to-use-variable-optional-in-useMutation/","nextSlug":"/react/react-query-basic/","prevSlug":"/react/recoil-introduction/"}},
    "staticQueryHashes": ["1073350324","2938748437"]}